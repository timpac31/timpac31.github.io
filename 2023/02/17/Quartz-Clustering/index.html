<!DOCTYPE html>
<html lang=ko>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="이슈운영중인 서버에서 스케줄링 작업을 하는게 있었는데 실행이 3번 중복 실행되는 문제가 발생하였다.문자를 발송하는 작업이였는데 3번 발송됨  분석실행환경은 Spring(4.0.0) + Quartz(1.8.5) 를 사용하고 있었다.기존에 스프링 quartz bean 설정은 다음과 같았다.MethodInvokingJobDetailFactoryBean을 사용하여">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Quartz Clustering">
<meta property="og:url" content="https://timpac31.github.io/2023/02/17/Quartz-Clustering/index.html">
<meta property="og:site_name" content="Timpac&#39;s Blog">
<meta property="og:description" content="이슈운영중인 서버에서 스케줄링 작업을 하는게 있었는데 실행이 3번 중복 실행되는 문제가 발생하였다.문자를 발송하는 작업이였는데 3번 발송됨  분석실행환경은 Spring(4.0.0) + Quartz(1.8.5) 를 사용하고 있었다.기존에 스프링 quartz bean 설정은 다음과 같았다.MethodInvokingJobDetailFactoryBean을 사용하여">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://timpac31.github.io/images/refer/quartz_cluster.png">
<meta property="article:published_time" content="2023-02-17T11:39:31.000Z">
<meta property="article:modified_time" content="2023-02-17T11:51:37.642Z">
<meta property="article:author" content="Jo Yeoung Duk">
<meta property="article:tag" content="quartz">
<meta property="article:tag" content="spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://timpac31.github.io/images/refer/quartz_cluster.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Spring Quartz Clustering</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2023/07/24/implementaion-patterns/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2022/08/02/%EC%9E%90%EB%B0%94-%EC%9E%AC%EA%B7%80%ED%95%A8%EC%88%98-%EA%BC%AC%EB%A6%AC%EB%AC%BC%EA%B8%B0-%EC%B5%9C%EC%A0%81%ED%99%94/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://timpac31.github.io/2023/02/17/Quartz-Clustering/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&text=Spring Quartz Clustering"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&title=Spring Quartz Clustering"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&is_video=false&description=Spring Quartz Clustering"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Spring Quartz Clustering&body=Check out this article: https://timpac31.github.io/2023/02/17/Quartz-Clustering/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&title=Spring Quartz Clustering"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&title=Spring Quartz Clustering"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&title=Spring Quartz Clustering"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&title=Spring Quartz Clustering"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&name=Spring Quartz Clustering&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%9D%B4%EC%8A%88"><span class="toc-number">1.</span> <span class="toc-text">이슈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%B6%84%EC%84%9D"><span class="toc-number">2.</span> <span class="toc-text">분석</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%84%A4%EC%A0%95-%EB%B3%80%EA%B2%BD"><span class="toc-number">3.</span> <span class="toc-text">설정 변경</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EA%B2%B0%EA%B3%BC"><span class="toc-number">4.</span> <span class="toc-text">결과</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%A3%BC%EC%9D%98-%EC%82%AC%ED%95%AD"><span class="toc-number">5.</span> <span class="toc-text">주의 사항</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%B0%B8%EC%A1%B0"><span class="toc-number">6.</span> <span class="toc-text">참조</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Spring Quartz Clustering
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Timpac's Blog</span>
      </span>
      
    <div class="postdate">
        <time datetime="2023-02-17T11:39:31.000Z" itemprop="datePublished">2023-02-17</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/quartz/" rel="tag">quartz</a>, <a class="tag-link-link" href="/tags/spring/" rel="tag">spring</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="이슈"><a href="#이슈" class="headerlink" title="이슈"></a>이슈</h2><p>운영중인 서버에서 스케줄링 작업을 하는게 있었는데 실행이 3번 중복 실행되는 문제가 발생하였다.<br>문자를 발송하는 작업이였는데 3번 발송됨 </p>
<h2 id="분석"><a href="#분석" class="headerlink" title="분석"></a>분석</h2><p>실행환경은 Spring(4.0.0) + Quartz(1.8.5) 를 사용하고 있었다.<br>기존에 스프링 quartz bean 설정은 다음과 같았다.<br>MethodInvokingJobDetailFactoryBean을 사용하여 스프링 빈의 메소드를 바로 실행시킨다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;smsSendUserCollectRequest&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetObject&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;smsSendUserCollectScheduling&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;targetMethod&quot;</span> <span class="attr">value</span>=<span class="string">&quot;smsSendUserCollectCollectMethod&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;concurrent&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;smsSendUserCollectRequestTrigger&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.CronTriggerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jobDetail&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;smsSendUserCollectRequest&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cronExpression&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0 0 5 * * ?&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;smsSendUserCollectCollectRequestScheduler&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.SchedulerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;triggers&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;smsSendUserCollectRequestTrigger&quot;</span> /&gt;</span>				</span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>cron trigger 표현식을 보면 “0 0 5 * * ?” 5시에 한번만 실행되는걸 볼 수 있다.<br>스케줄러 자체 설정엔 문제가 없었지만 중복실행되는 이유는<br>WAS가 이중화되어 있었기 때문이였다. JEUS WAS를 사용하는데 3개의 container로 나뉘어져있었고 3개의 container에서 모두 실행되고 있었던 것이다.</p>
<p><img src="/images/refer/quartz_cluster.png" alt="quart-clustering"></p>
<p>다행히 quartz lib에서 clustering을 지원하고 있어서 생각보다 어렵지 않게 문제를 해결할 수 있었다.<br>클러스터링을 적용하려면 스프링쿼츠의 SchedulerFactoryBean 설정을 변경해주어야한다.</p>
<h2 id="설정-변경"><a href="#설정-변경" class="headerlink" title="설정 변경"></a>설정 변경</h2><ol>
<li>JobDetailBean로 변경</li>
</ol>
<p>기존 설정에서는 org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean을 사용하여 스프링 빈의 메소드를 바로 실행했는데<br>이방식은 클러스터링이되지 않기 때문에 org.springframework.scheduling.quartz.JobDetailBean 방식으로 변경해야했다.<br>JobDetailBean의 JobClass는 QuartzJobBean 클래스를 상속하여 executeInternal 메소드를 오버라이드 해야한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;smsSendUserCollectRequest&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">smsSendUserCollectScheduling</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SmsService smsService;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;					</span><br><span class="line">			doTask();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> JobExecutionException(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//do something</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br>

<ol start="2">
<li>스프링 빈 설정 변경</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;smsSendUserCollectRequest&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.JobDetailBean&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jobClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;io.timpac.smsSendUserCollectScheduling&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;smsSendUserCollectRequestTrigger&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.CronTriggerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jobDetail&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;smsSendUserCollectRequest&quot;</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cronExpression&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0 0 5 * * ?&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;ClusterScheduler&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.SchedulerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;triggers&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;smsSendUserCollectRequestTrigger&quot;</span> /&gt;</span>		</span><br><span class="line">		<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:quartz.properties&quot;</span> /&gt;</span></span><br><span class="line">  	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<br>

<ol start="3">
<li>quartz.properties 속성 설정</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">org.quartz.jobStore.useProperties</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">org.quartz.jobStore.class</span>=<span class="string">org.quartz.impl.jdbcjobstore.JobStoreTX</span></span><br><span class="line"><span class="meta">org.quartz.jobStore.driverDelegateClass</span>=<span class="string">org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span></span><br><span class="line"><span class="meta">org.quartz.jobStore.dataSource</span>=<span class="string">dataSource</span></span><br><span class="line"><span class="meta">org.quartz.jobStore.tablePrefix</span>=<span class="string">QRTZ_</span></span><br><span class="line"><span class="meta">org.quartz.jobStore.isClustered</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">org.quartz.jobStore.clusterCheckinInterval</span>=<span class="string">20000</span></span><br><span class="line"><span class="meta">org.quartz.jobStore.misfireThreshold</span>=<span class="string">60000</span></span><br><span class="line"><span class="meta">org.quartz.scheduler.instanceId</span>=<span class="string">AUTO</span></span><br><span class="line"><span class="meta">org.quartz.scheduler.instanceName</span>=<span class="string">MyClusteredScheduler</span></span><br><span class="line"><span class="meta">org.quartz.threadPool.class</span>=<span class="string">org.quartz.simpl.SimpleThreadPool</span></span><br><span class="line"><span class="meta">org.quartz.threadPool.threadCount</span>=<span class="string">4</span></span><br><span class="line"><span class="meta">org.quartz.threadPool.threadPriority</span>=<span class="string">5</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>각 속성의 설정정보는 아래링크 참조<br><a target="_blank" rel="noopener" href="http://www.quartz-scheduler.org/documentation/quartz-1.8.6/configuration/ConfigJDBCJobStoreClustering">http://www.quartz-scheduler.org/documentation/quartz-1.8.6/configuration/ConfigJDBCJobStoreClustering</a></p>
</blockquote>
<br>

<ol start="4">
<li>database table 생성<br>클러스터링 동기화를 위한 데이터베이스 테이블을 생성해준다.</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_job_details</span><br><span class="line">  (</span><br><span class="line">    JOB_NAME  VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    JOB_GROUP VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    DESCRIPTION VARCHAR2(<span class="number">250</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    JOB_CLASS_NAME   VARCHAR2(<span class="number">250</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">    IS_DURABLE VARCHAR2(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    IS_VOLATILE VARCHAR2(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    IS_STATEFUL VARCHAR2(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    REQUESTS_RECOVERY VARCHAR2(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    JOB_DATA <span class="type">BLOB</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (JOB_NAME,JOB_GROUP)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_job_listeners</span><br><span class="line">  (</span><br><span class="line">    JOB_NAME  VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">    JOB_GROUP VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    JOB_LISTENER VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (JOB_NAME,JOB_GROUP,JOB_LISTENER),</span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (JOB_NAME,JOB_GROUP) </span><br><span class="line">	<span class="keyword">REFERENCES</span> QRTZ_JOB_DETAILS(JOB_NAME,JOB_GROUP)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_triggers</span><br><span class="line">  (</span><br><span class="line">    TRIGGER_NAME VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    TRIGGER_GROUP VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    JOB_NAME  VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">    JOB_GROUP VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    IS_VOLATILE VARCHAR2(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    DESCRIPTION VARCHAR2(<span class="number">250</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    NEXT_FIRE_TIME NUMBER(<span class="number">13</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    PREV_FIRE_TIME NUMBER(<span class="number">13</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    PRIORITY NUMBER(<span class="number">13</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    TRIGGER_STATE VARCHAR2(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    TRIGGER_TYPE VARCHAR2(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    START_TIME NUMBER(<span class="number">13</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    END_TIME NUMBER(<span class="number">13</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    CALENDAR_NAME VARCHAR2(<span class="number">200</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    MISFIRE_INSTR NUMBER(<span class="number">2</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    JOB_DATA <span class="type">BLOB</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (JOB_NAME,JOB_GROUP) </span><br><span class="line">	<span class="keyword">REFERENCES</span> QRTZ_JOB_DETAILS(JOB_NAME,JOB_GROUP) </span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_simple_triggers</span><br><span class="line">  (</span><br><span class="line">    TRIGGER_NAME VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    TRIGGER_GROUP VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    REPEAT_COUNT NUMBER(<span class="number">7</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    REPEAT_INTERVAL NUMBER(<span class="number">12</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    TIMES_TRIGGERED NUMBER(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (TRIGGER_NAME,TRIGGER_GROUP) </span><br><span class="line">	<span class="keyword">REFERENCES</span> QRTZ_TRIGGERS(TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_cron_triggers</span><br><span class="line">  (</span><br><span class="line">    TRIGGER_NAME VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    TRIGGER_GROUP VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    CRON_EXPRESSION VARCHAR2(<span class="number">120</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    TIME_ZONE_ID VARCHAR2(<span class="number">80</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (TRIGGER_NAME,TRIGGER_GROUP) </span><br><span class="line">	<span class="keyword">REFERENCES</span> QRTZ_TRIGGERS(TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_blob_triggers</span><br><span class="line">  (</span><br><span class="line">    TRIGGER_NAME VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    TRIGGER_GROUP VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    BLOB_DATA <span class="type">BLOB</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (TRIGGER_NAME,TRIGGER_GROUP),</span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (TRIGGER_NAME,TRIGGER_GROUP) </span><br><span class="line">        <span class="keyword">REFERENCES</span> QRTZ_TRIGGERS(TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_trigger_listeners</span><br><span class="line">  (</span><br><span class="line">    TRIGGER_NAME  VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">    TRIGGER_GROUP VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    TRIGGER_LISTENER VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (TRIGGER_NAME,TRIGGER_GROUP,TRIGGER_LISTENER),</span><br><span class="line">    <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> (TRIGGER_NAME,TRIGGER_GROUP) </span><br><span class="line">	<span class="keyword">REFERENCES</span> QRTZ_TRIGGERS(TRIGGER_NAME,TRIGGER_GROUP)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_calendars</span><br><span class="line">  (</span><br><span class="line">    CALENDAR_NAME  VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">    CALENDAR <span class="type">BLOB</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (CALENDAR_NAME)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_paused_trigger_grps</span><br><span class="line">  (</span><br><span class="line">    TRIGGER_GROUP  VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (TRIGGER_GROUP)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_fired_triggers </span><br><span class="line">  (</span><br><span class="line">    ENTRY_ID VARCHAR2(<span class="number">95</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    TRIGGER_NAME VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    TRIGGER_GROUP VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    IS_VOLATILE VARCHAR2(<span class="number">1</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    INSTANCE_NAME VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    FIRED_TIME NUMBER(<span class="number">13</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    PRIORITY NUMBER(<span class="number">13</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    STATE VARCHAR2(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    JOB_NAME VARCHAR2(<span class="number">200</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    JOB_GROUP VARCHAR2(<span class="number">200</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    IS_STATEFUL VARCHAR2(<span class="number">1</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    REQUESTS_RECOVERY VARCHAR2(<span class="number">1</span>) <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (ENTRY_ID)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_scheduler_state </span><br><span class="line">  (</span><br><span class="line">    INSTANCE_NAME VARCHAR2(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    LAST_CHECKIN_TIME NUMBER(<span class="number">13</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    CHECKIN_INTERVAL NUMBER(<span class="number">13</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (INSTANCE_NAME)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> qrtz_locks</span><br><span class="line">  (</span><br><span class="line">    LOCK_NAME  VARCHAR2(<span class="number">40</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, </span><br><span class="line">    <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (LOCK_NAME)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> qrtz_locks <span class="keyword">values</span>(<span class="string">&#x27;TRIGGER_ACCESS&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> qrtz_locks <span class="keyword">values</span>(<span class="string">&#x27;JOB_ACCESS&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> qrtz_locks <span class="keyword">values</span>(<span class="string">&#x27;CALENDAR_ACCESS&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> qrtz_locks <span class="keyword">values</span>(<span class="string">&#x27;STATE_ACCESS&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> qrtz_locks <span class="keyword">values</span>(<span class="string">&#x27;MISFIRE_ACCESS&#x27;</span>);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_j_req_recovery <span class="keyword">on</span> qrtz_job_details(REQUESTS_RECOVERY);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_t_next_fire_time <span class="keyword">on</span> qrtz_triggers(NEXT_FIRE_TIME);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_t_state <span class="keyword">on</span> qrtz_triggers(TRIGGER_STATE);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_t_nft_st <span class="keyword">on</span> qrtz_triggers(NEXT_FIRE_TIME,TRIGGER_STATE);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_t_volatile <span class="keyword">on</span> qrtz_triggers(IS_VOLATILE);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_ft_trig_name <span class="keyword">on</span> qrtz_fired_triggers(TRIGGER_NAME);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_ft_trig_group <span class="keyword">on</span> qrtz_fired_triggers(TRIGGER_GROUP);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_ft_trig_nm_gp <span class="keyword">on</span> qrtz_fired_triggers(TRIGGER_NAME,TRIGGER_GROUP);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_ft_trig_volatile <span class="keyword">on</span> qrtz_fired_triggers(IS_VOLATILE);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_ft_trig_inst_name <span class="keyword">on</span> qrtz_fired_triggers(INSTANCE_NAME);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_ft_job_name <span class="keyword">on</span> qrtz_fired_triggers(JOB_NAME);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_ft_job_group <span class="keyword">on</span> qrtz_fired_triggers(JOB_GROUP);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_ft_job_stateful <span class="keyword">on</span> qrtz_fired_triggers(IS_STATEFUL);</span><br><span class="line"><span class="keyword">create</span> index idx_qrtz_ft_job_req_recovery <span class="keyword">on</span> qrtz_fired_triggers(REQUESTS_RECOVERY);</span><br></pre></td></tr></table></figure>
<h2 id="결과"><a href="#결과" class="headerlink" title="결과"></a>결과</h2><p>서버에 적용하고 모니터링 해본 결과 하나의 인스턴스만 실행되는 것을 확인할 수 있었다.<br>분산서버 환경이나 이중화된 WAS환경에서 Quartz를 적용하려면 꼭 클러스터링을 해 주어야 중복실행을 막을 수 있다.</p>
<h2 id="주의-사항"><a href="#주의-사항" class="headerlink" title="주의 사항"></a>주의 사항</h2><ul>
<li>설정변경시 qrtz_* 테이블 삭제<br>quartz trigger나 job 설정을 변경할 경우 생성했던 qrtz_* 테이블들의 정보도 지워준 후에 서버를 재시작하는게 깔끔하다.<br>테이블에 trigger나 job 정보들이 남아있어서 중복실행되거나 에러를 발생시키는 경우가 있었다.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> qrtz_job_listeners;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> qrtz_trigger_listeners;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> qrtz_fired_triggers;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> qrtz_simple_triggers;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> qrtz_cron_triggers;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> qrtz_blob_triggers;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> qrtz_triggers;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> qrtz_job_details;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> qrtz_calendars;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> qrtz_paused_trigger_grps;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> qrtz_scheduler_state;</span><br></pre></td></tr></table></figure>
<ul>
<li>Quartz JobClass에서 Spring bean injection<br>실행시킬 Job 클래스에서 @Autowired 등으로 스프링 빈을 주입받아 사용하고 싶을 때가 있다.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;smsSendUserCollectRequest&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">smsSendUserCollectScheduling</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SmsService smsService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        smsService.send();  <span class="comment">// NullPointerException 발생!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위와 같이 사용하니까 NullPointerException이 발생했다.<br>아마도 쿼츠에서는 스프링 빈을 가져오지 않고 프록시 클래스를 사용해 메소드를 호출하기 때문에 의존성 주입이 안된 채로 실행되는게 아닐까 생각한다.<br>나는 메소드안에서 직접 의존성을 주입해주는 방식으로 해결했다.<br>쿼츠 잡클래스에서 빈을 주입받으려면 SchedulerFactoryBean에 applicationContextSchedulerContextKey 설정을 해야한다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;ClusterScheduler&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.scheduling.quartz.SchedulerFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;applicationContextSchedulerContextKey&quot;</span> <span class="attr">value</span>=<span class="string">&quot;applicationContext&quot;</span>/&gt;</span> </span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;smsSendUserCollectRequest&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">smsSendUserCollectScheduling</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SmsService smsService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        ApplicationContext applicationContext = (ApplicationContext) context.getScheduler().getContext().get(<span class="string">&quot;applicationContext&quot;</span>);</span><br><span class="line">		<span class="keyword">this</span>.smsService = applicationContext.getBean(SmsService.class);</span><br><span class="line"></span><br><span class="line">        smsService.send(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><p><a target="_blank" rel="noopener" href="http://www.quartz-scheduler.org/documentation/quartz-1.8.6/configuration/ConfigJDBCJobStoreClustering">http://www.quartz-scheduler.org/documentation/quartz-1.8.6/configuration/ConfigJDBCJobStoreClustering</a><br><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#io.quartz">https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#io.quartz</a><br><a target="_blank" rel="noopener" href="https://junhyunny.github.io/spring-mvc/quartz-clustering-in-spring-mvc/">https://junhyunny.github.io/spring-mvc/quartz-clustering-in-spring-mvc/</a></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%9D%B4%EC%8A%88"><span class="toc-number">1.</span> <span class="toc-text">이슈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%B6%84%EC%84%9D"><span class="toc-number">2.</span> <span class="toc-text">분석</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%84%A4%EC%A0%95-%EB%B3%80%EA%B2%BD"><span class="toc-number">3.</span> <span class="toc-text">설정 변경</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EA%B2%B0%EA%B3%BC"><span class="toc-number">4.</span> <span class="toc-text">결과</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%A3%BC%EC%9D%98-%EC%82%AC%ED%95%AD"><span class="toc-number">5.</span> <span class="toc-text">주의 사항</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%B0%B8%EC%A1%B0"><span class="toc-number">6.</span> <span class="toc-text">참조</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://timpac31.github.io/2023/02/17/Quartz-Clustering/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&text=Spring Quartz Clustering"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&title=Spring Quartz Clustering"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&is_video=false&description=Spring Quartz Clustering"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Spring Quartz Clustering&body=Check out this article: https://timpac31.github.io/2023/02/17/Quartz-Clustering/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&title=Spring Quartz Clustering"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&title=Spring Quartz Clustering"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&title=Spring Quartz Clustering"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&title=Spring Quartz Clustering"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://timpac31.github.io/2023/02/17/Quartz-Clustering/&name=Spring Quartz Clustering&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2023 Jo Yeoung Duk
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<link rel="stylesheet" href="/lib/meslo-LG/styles.css">


<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>


<script src="/js/main.js"></script>




    <!-- Disqus Comments -->
    <script type="text/javascript">
        var disqus_shortname = 'timpac';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


