<!DOCTYPE html>
<html lang=ko>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="목표 AMQP 프로토콜에 대한 이해 메시지 전송 기반 시스템으로 음식점에 주문을 하는 간단한 시스템을 만들기 message queuing을 위해서 AMQP Broker인 RabbitMQ를 사용  AMQP란?메시지 전송을 위한 프로토콜로 다음 그림을 보면 쉽게 이해가된다. Advanced Message Queuing Protocol  Message Excha">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring AMQP + RabbitMQ message pub&#x2F;sub example">
<meta property="og:url" content="https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/index.html">
<meta property="og:site_name" content="Timpac&#39;s Blog">
<meta property="og:description" content="목표 AMQP 프로토콜에 대한 이해 메시지 전송 기반 시스템으로 음식점에 주문을 하는 간단한 시스템을 만들기 message queuing을 위해서 AMQP Broker인 RabbitMQ를 사용  AMQP란?메시지 전송을 위한 프로토콜로 다음 그림을 보면 쉽게 이해가된다. Advanced Message Queuing Protocol  Message Excha">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://timpac31.github.io/images/refer/amqp/amqp.png">
<meta property="og:image" content="https://timpac31.github.io/images/refer/amqp/amqp_rabbit1.png">
<meta property="og:image" content="https://timpac31.github.io/images/refer/amqp/amqp_postman.png">
<meta property="og:image" content="https://timpac31.github.io/images/refer/amqp/amqp_rabbit2.png">
<meta property="og:image" content="https://timpac31.github.io/images/refer/amqp/amqp_console.png">
<meta property="article:published_time" content="2021-03-04T11:08:08.000Z">
<meta property="article:modified_time" content="2021-03-04T12:19:04.999Z">
<meta property="article:author" content="Jo Yeoung Duk">
<meta property="article:tag" content="AMQP">
<meta property="article:tag" content="RabbitMQ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://timpac31.github.io/images/refer/amqp/amqp.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Spring AMQP + RabbitMQ message pub/sub example</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2021/02/18/Shell-script%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4%EC%84%9C-Linux-monitoring-page-%EB%A7%8C%EB%93%A4%EA%B8%B0/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&text=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&title=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&is_video=false&description=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Spring AMQP + RabbitMQ message pub/sub example&body=Check out this article: https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&title=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&title=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&title=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&title=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&name=Spring AMQP + RabbitMQ message pub/sub example&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%AA%A9%ED%91%9C"><span class="toc-number">1.</span> <span class="toc-text">목표</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AMQP%EB%9E%80"><span class="toc-number">2.</span> <span class="toc-text">AMQP란?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Required"><span class="toc-number">3.</span> <span class="toc-text">Required</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup-the-RabbitMQ"><span class="toc-number">4.</span> <span class="toc-text">Setup the RabbitMQ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-boot-Application"><span class="toc-number">5.</span> <span class="toc-text">Spring boot Application</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Message-Sender"><span class="toc-number">6.</span> <span class="toc-text">Message Sender</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Send-a-Test-Message"><span class="toc-number">7.</span> <span class="toc-text">Send a Test Message</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Receiver"><span class="toc-number">8.</span> <span class="toc-text">Receiver</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%B0%B8%EC%A1%B0"><span class="toc-number">9.</span> <span class="toc-text">참조</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Spring AMQP + RabbitMQ message pub/sub example
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Timpac's Blog</span>
      </span>
      
    <div class="postdate">
        <time datetime="2021-03-04T11:08:08.000Z" itemprop="datePublished">2021-03-04</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link-link" href="/tags/AMQP/" rel="tag">AMQP</a>, <a class="tag-link-link" href="/tags/RabbitMQ/" rel="tag">RabbitMQ</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="목표"><a href="#목표" class="headerlink" title="목표"></a>목표</h2><ul>
<li>AMQP 프로토콜에 대한 이해</li>
<li>메시지 전송 기반 시스템으로 음식점에 주문을 하는 간단한 시스템을 만들기</li>
<li>message queuing을 위해서 AMQP Broker인 RabbitMQ를 사용</li>
</ul>
<h2 id="AMQP란"><a href="#AMQP란" class="headerlink" title="AMQP란?"></a>AMQP란?</h2><p>메시지 전송을 위한 프로토콜로 다음 그림을 보면 쉽게 이해가된다.<br><br/></p>
<p><img src="/images/refer/amqp/amqp.png" alt="amqp"><em>Advanced Message Queuing Protocol</em></p>
<ul>
<li>Message</li>
<li>Exchange : 메시지를 담고 있으며, queue에 바인딩 시키는 라우터 역할을 한다. 종류는 다음과 같다.<ul>
<li>Direct Exchange : routing key를 기반으로 큐에 전달</li>
<li>Fanout Exchange : 모든 큐에 전달</li>
<li>Topic Exchange : routing key 패턴으로 바인딩</li>
<li>Headers Exchange : 해더 속성을 사용하여 바인딩</li>
</ul>
</li>
<li>Queue : 대기열</li>
<li>Binding : Exchange가 Queue에 바인딩하기 위한 rule<blockquote>
<p>RabbitMQ 사이트에 재밌는 예시가 있다.<br>“Queue가 뉴욕의 한 목적지 라면, Exchange는 JFK 공항이고, Bindings는 목적지까지 가는 여러개의 길이다.”</p>
</blockquote>
</li>
</ul>
<h2 id="Required"><a href="#Required" class="headerlink" title="Required"></a>Required</h2><ul>
<li>Java 11</li>
<li>RabbitMQ 3.8.14</li>
<li>Spring boot 2.4.3</li>
</ul>
<h2 id="Setup-the-RabbitMQ"><a href="#Setup-the-RabbitMQ" class="headerlink" title="Setup the RabbitMQ"></a>Setup the RabbitMQ</h2><ul>
<li>RabbitMQ <a target="_blank" rel="noopener" href="https://www.rabbitmq.com/">다운로드</a></li>
<li>다운로드하여 직접 설치해도 되지만 필자는 편의상 Docker로 실행하였다.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&gt; docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management</span><br></pre></td></tr></table></figure>
도커 실행 후 <a href="http://localhost:15672로">http://localhost:15672로</a> 접속하여 로그인 화면이 나온다면 제대로 구동된 것이다.<br>guest 계정으로 접속하면 다음과 같은 Rabbit Management 화면을 볼 수 있다.<br/>

</li>
</ul>
<p><img src="/images/refer/amqp/amqp_rabbit1.png" alt="amqp"></p>
<h2 id="Spring-boot-Application"><a href="#Spring-boot-Application" class="headerlink" title="Spring boot Application"></a>Spring boot Application</h2><ul>
<li><a target="_blank" rel="noopener" href="https://start.spring.io/">Spring Initializr</a>를 사용해 spring boot 프로젝트를 하나 만든다<br>dependency에 spring-boot-starter-amqp를 추가해준다.</li>
</ul>
<p>pom.xml :</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.timpac<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>amqpdemo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">name</span>&gt;</span>amqpdemo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>11<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Message-Sender"><a href="#Message-Sender" class="headerlink" title="Message Sender"></a>Message Sender</h2><ul>
<li><p>우선 메시지 송신을 위한 AMQP 관련 객체들을 bean으로 등록한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.timpac.amqpdemo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.AmqpTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.TopicExchange;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.connection.ConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.support.converter.Jackson2JsonMessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.support.converter.MessageConverter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderAmqpConfig</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String QUEUE_NAME = <span class="string">&quot;ORDER_QUEUE&quot;</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String EXCHANGE_NAME = <span class="string">&quot;ORDER_EXCHANGE&quot;</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ROUTING_KEY_PREPEND = <span class="string">&quot;IO.TIMPAC.&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Queue <span class="title">queue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Queue(QUEUE_NAME);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> TopicExchange <span class="title">exchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> TopicExchange(EXCHANGE_NAME);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Binding <span class="title">binding</span><span class="params">(Queue queue, TopicExchange exchange)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(ROUTING_KEY_PREPEND + <span class="string">&quot;#&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> MessageConverter <span class="title">messageConverter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Jackson2JsonMessageConverter();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> AmqpTemplate <span class="title">amqpTemplate</span><span class="params">(ConnectionFactory connectionFactory)</span> </span>&#123;</span><br><span class="line">		RabbitTemplate template = <span class="keyword">new</span> RabbitTemplate(connectionFactory);</span><br><span class="line">		template.setMessageConverter(messageConverter());</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>queue() : “ORDER_QUEUE”란 이름을 가진 Queue를 만든다.<br>exchange() : “ORDER_EXCHANGE”란 이름을 가진 Exchange를 만든다. 패턴으로 바인딩하기 위해 TopicExchange로 만들었다.<br>amqpTemplate() : RabbitTemplate을 등록해준다. json형식으로 보내기 위해서 messegeConverter로 Jackson2JsonMessageConverter를 사용하였다.</p>
<br/>
</li>
<li><p>주문 정보를 담을 ORDER 클래스를 만든다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.timpac.amqpdemo.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String orderId;</span><br><span class="line">	<span class="keyword">private</span> String menu;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> quantity;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> price;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getOrderId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> orderId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderId</span><span class="params">(String orderId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.orderId = orderId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getMenu</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> menu;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMenu</span><span class="params">(String menu)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.menu = menu;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getQuantity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> quantity;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQuantity</span><span class="params">(<span class="keyword">int</span> quantity)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.quantity = quantity;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> price;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">int</span> price)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.price = price;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;Order [orderId=&quot;</span> + orderId + <span class="string">&quot;, menu=&quot;</span> + menu + <span class="string">&quot;, quantity=&quot;</span> + quantity + <span class="string">&quot;, price=&quot;</span> + price + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>대충 메뉴, 수량, 가격 등 간단하게 만들었다.</p>
<br/>
</li>
<li><p>주문 메시지를 전송할 Publisher를 만든다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.timpac.amqpdemo.publisher;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> io.timpac.amqpdemo.config.OrderAmqpConfig;</span><br><span class="line"><span class="keyword">import</span> io.timpac.amqpdemo.dto.Order;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderPublisherController</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> RabbitTemplate template;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">OrderPublisherController</span><span class="params">(RabbitTemplate template)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.template = template;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@PostMapping(&quot;&#123;restaurant&#125;&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">order</span><span class="params">(<span class="meta">@RequestBody</span> Order order, <span class="meta">@PathVariable</span> String restaurant)</span> </span>&#123;</span><br><span class="line">		order.setOrderId(UUID.randomUUID().toString());</span><br><span class="line">		template.convertAndSend(OrderAmqpConfig.EXCHANGE_NAME, OrderAmqpConfig.ROUTING_KEY_PREPEND + restaurant, order);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;주문 완료&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>RabbitTemplate의 convertAndSend() 메서드를 이용해 message를 Rabbit 서버에 전송한다.<br>인자로는 Exchange name, Routing Key, Playload가 들어간다.<br>Exchange name에는 OrderAmqpConfig에서 지정한 EXCHANGE_NAME을 넣는다<br>Routing Key는 음식점별로 큐를 분리하기 위해서 패턴 뒤에 음식점 이름을 패스인자로 받아서 넣었다<br>Playload에는 주문정보가 담긴 Order 객체가 들어간다.</p>
</li>
</ul>
<h2 id="Send-a-Test-Message"><a href="#Send-a-Test-Message" class="headerlink" title="Send a Test Message"></a>Send a Test Message</h2><p>이제 메시지 전송 테스트를 해보자. POSTMAN을 사용하여 다음과 같이 요청했다.<br><img src="/images/refer/amqp/amqp_postman.png" alt="amqp"></p>
<blockquote>
<p>내가 좋아하는 맘스터치 화이트갈릭버거를 신청했다. (맘스터치 광고 아님 ^^)</p>
</blockquote>
<p>신청 후 다시 RabbitMQ 관리자 페이지를 확인해보자<br><img src="/images/refer/amqp/amqp_rabbit2.png" alt="amqp"><br>위와 같이 큐에 메시지 하나가 들어가 있는걸 볼 수 있다. 리시버를 아직 등록하지 않았기 때문에 대기 상태에 있다.</p>
<h2 id="Receiver"><a href="#Receiver" class="headerlink" title="Receiver"></a>Receiver</h2><p>메시지를 받을 Receiver도 등록해보자</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> io.timpac.amqpdemo.receiver;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> io.timpac.amqpdemo.config.OrderAmqpConfig;</span><br><span class="line"><span class="keyword">import</span> io.timpac.amqpdemo.dto.Order;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Restaurant</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@RabbitListener(queues = OrderAmqpConfig.QUEUE_NAME)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMessage</span><span class="params">(Order order)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;배달의 민족 주문~ : &quot;</span> + order.toString());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@RabbitListener 어노테이션을 쓰면 쉽게 리스너로 등록 가능하다</p>
<p>다시 POST 요청을 보내고 확인해보면 아래와 같이 메시지를 받은 것을 확인할 수 있다.<br><br/></p>
<p><img src="/images/refer/amqp/amqp_console.png" alt="amqp"></p>
<h2 id="참조"><a href="#참조" class="headerlink" title="참조"></a>참조</h2><ul>
<li><a target="_blank" rel="noopener" href="https://spring.io/guides/gs/messaging-rabbitmq/">https://spring.io/guides/gs/messaging-rabbitmq/</a></li>
<li><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=o4qCdBR4gUM">https://www.youtube.com/watch?v=o4qCdBR4gUM</a></li>
<li><a target="_blank" rel="noopener" href="https://www.rabbitmq.com/tutorials/tutorial-five-java.html">https://www.rabbitmq.com/tutorials/tutorial-five-java.html</a></li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%AA%A9%ED%91%9C"><span class="toc-number">1.</span> <span class="toc-text">목표</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AMQP%EB%9E%80"><span class="toc-number">2.</span> <span class="toc-text">AMQP란?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Required"><span class="toc-number">3.</span> <span class="toc-text">Required</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Setup-the-RabbitMQ"><span class="toc-number">4.</span> <span class="toc-text">Setup the RabbitMQ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-boot-Application"><span class="toc-number">5.</span> <span class="toc-text">Spring boot Application</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Message-Sender"><span class="toc-number">6.</span> <span class="toc-text">Message Sender</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Send-a-Test-Message"><span class="toc-number">7.</span> <span class="toc-text">Send a Test Message</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Receiver"><span class="toc-number">8.</span> <span class="toc-text">Receiver</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%B0%B8%EC%A1%B0"><span class="toc-number">9.</span> <span class="toc-text">참조</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&text=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&title=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&is_video=false&description=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Spring AMQP + RabbitMQ message pub/sub example&body=Check out this article: https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&title=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&title=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&title=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&title=Spring AMQP + RabbitMQ message pub/sub example"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://timpac31.github.io/2021/03/04/Spring-AMQP-RabbitMQ-message-pub-sub-example/&name=Spring AMQP + RabbitMQ message pub/sub example&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2021 Jo Yeoung Duk
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Archives</a></li>
         
          <li><a href="/Search/">Search</a></li>
         
          <li><a href="/tags/">Tags</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<link rel="stylesheet" href="/lib/meslo-LG/styles.css">


<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">


<!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>


<script src="/js/main.js"></script>




    <!-- Disqus Comments -->
    <script type="text/javascript">
        var disqus_shortname = 'timpac';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


